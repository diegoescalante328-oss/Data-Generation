# Tiny web events dataset for CI, focused on event skew and rare monetization.
# Tests: user->events relationship, poisson session durations, and rare purchase events.
dataset: web_events
seed: 7
tables:
  users:
    rows: 50
    columns:
      - name: user_id
        type: id
        constraints:
          primary_key: true
          unique: true
      - name: country
        type: categorical
        categories: [US, CA, UK, DE, IN, BR]
        weights: [0.32, 0.11, 0.14, 0.11, 0.24, 0.08]
      - name: signup_date
        type: date
        start: '2022-01-01'
        end: '2024-01-31'
      - name: device_type
        type: categorical
        categories: [mobile, desktop, tablet]
        weights: [0.64, 0.31, 0.05]
  events:
    rows: 300
    corruption:
      duplicate_rate: 0.005
      type_noise:
        duration_sec:
          rate: 0.002
          value: N/A
    columns:
      - name: event_id
        type: id
        constraints:
          primary_key: true
          unique: true
      - name: user_id
        type: integer
      - name: signup_date
        type: date
        start: '2022-01-01'
        end: '2024-01-31'
      - name: event_time
        # Distribution window intentionally long to model activity drift after signup.
        computed: rand_days_after(signup_date, 0, 420)
      - name: event_type
        type: categorical
        # Long-tail interaction mix with purchase kept intentionally rare.
        categories: [view, click, add_to_cart, wishlist, purchase]
        weights: [0.62, 0.23, 0.08, 0.05, 0.02]
      - name: session_id
        type: string_pattern
        prefix: sess_
        width: 8
      - name: duration_sec
        type: integer
        distribution: poisson
        lambda: 48
        min: 1
        max: 1200
      - name: page
        type: categorical
        categories: [/home, /search, /product, /checkout, /blog, /pricing]
        weights: [0.19, 0.29, 0.3, 0.06, 0.1, 0.06]
      - name: revenue
        # Most events are non-monetized; purchases draw from a right-skewed spend curve.
        computed: round(max(0, normal(84, 34)), 2) if event_type == 'purchase' else 0
relationships:
  - parent_table: users
    parent_key: user_id
    child_table: events
    child_key: user_id
    # Allows both light and heavy users to test cardinality spread.
    min_children: 1
    max_children: 30
    lookup_columns:
      signup_date: signup_date
