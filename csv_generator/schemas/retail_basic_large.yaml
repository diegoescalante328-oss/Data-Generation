# Tiny retail dataset for CI and schema validation.
# Tests: many-to-many modeling via order_items, skewed product demand, and lognormal pricing.
dataset: retail_basic
seed: 42
tables:
  customers:
    rows: 50000000000
    columns:
      - name: customer_id
        type: id
        constraints:
          primary_key: true
          unique: true
          monotonic_increasing: true
      - name: signup_date
        type: date
        start: '2020-01-01'
        end: '2023-12-31'
      - name: region
        type: categorical
        categories: [north, south, east, west]
        weights: [0.3, 0.25, 0.25, 0.2]
      - name: age
        type: integer
        distribution: normal
        mean: 38
        std: 12
        min: 18
        max: 85
      - name: email
        type: email
        constraints:
          unique: true
  products:
    rows: 30000
    columns:
      - name: product_id
        type: id
        constraints:
          primary_key: true
          unique: true
      - name: category
        type: categorical
        # Long-tail category mix for realistic catalog balance.
        categories: [electronics, apparel, grocery, home, beauty, books]
        weights: [0.14, 0.25, 0.22, 0.16, 0.14, 0.09]
      - name: base_price
        type: float
        distribution: lognormal
        # Lognormal prices produce many low/mid-priced items and a few expensive ones.
        mean: 3.1
        sigma: 0.55
        min: 3
        max: 1200
        round: 2
      - name: popularity_tier
        type: categorical
        categories: [head, mid, tail]
        # Heavily skewed so a small head set captures most demand.
        weights: [0.12, 0.34, 0.54]
  orders:
    rows: 120
    corruption:
      missing_by_column:
        discount_rate: 0.01
      outlier_rate: 0.02
    columns:
      - name: order_id
        type: id
        constraints:
          primary_key: true
          unique: true
          monotonic_increasing: true
      - name: customer_id
        type: integer
      - name: signup_date
        type: date
        start: '2020-01-01'
        end: '2023-12-31'
      - name: order_date
        computed: rand_days_after(signup_date, 0, 540)
      - name: order_channel
        type: categorical
        categories: [online, store, partner]
        weights: [0.67, 0.24, 0.09]
      - name: discount_rate
        type: categorical
        categories: [0, 0.05, 0.1, 0.15, 0.25]
        # Discounts are intentionally skewed toward no/low discount.
        weights: [0.42, 0.26, 0.2, 0.09, 0.03]
  order_items:
    rows: 12000000
    corruption:
      missing_by_column:
        unit_price: 0.002
    columns:
      - name: order_item_id
        type: id
        constraints:
          primary_key: true
          unique: true
      - name: order_id
        type: integer
      - name: product_id
        type: integer
      - name: base_price
        type: float
        distribution: uniform
        min: 10
        max: 50
      - name: quantity
        type: integer
        distribution: poisson
        # Poisson keeps low counts common while allowing occasional larger baskets.
        lambda: 1.7
        min: 1
        max: 12
      - name: unit_price
        computed: round(base_price * (1 + normal(0, 0.08)), 2)
      - name: line_revenue
        computed: round(quantity * unit_price, 2)
relationships:
  - parent_table: customers
    parent_key: customer_id
    child_table: orders
    child_key: customer_id
    # Includes inactive users while permitting heavy repeat buyers.
    min_children: 0
    max_children: 15
    lookup_columns:
      signup_date: signup_date
  - parent_table: orders
    parent_key: order_id
    child_table: order_items
    child_key: order_id
    # Multi-item orders are common; 1-8 keeps order widths realistic.
    min_children: 1
    max_children: 8
  - parent_table: products
    parent_key: product_id
    child_table: order_items
    child_key: product_id
    # Popularity skew emerges from cardinality plus category/tier distributions.
    min_children: 1
    max_children: 220
    lookup_columns:
      base_price: base_price
